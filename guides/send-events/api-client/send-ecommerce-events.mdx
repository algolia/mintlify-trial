---
title: 'Send ecommerce events with an API client'
sidebarTitle: 'Send ecommerce events'
description: Collect user interactions as events in your ecommerce store.
---

import Intro from '/snippets/insights/intro.mdx';

<Intro />

import EnableEventsCollection from '/snippets/insights/enable-events-collection.mdx';

<EnableEventsCollection />

import InitializeClient from '/snippets/insights/initialize-client.mdx';

<InitializeClient />

import EventsToTrack from '/snippets/insights/events-to-track.mdx';

<EventsToTrack />

<Tabs>
  <Tab title="Search results page">
    ![Search results page](/images/events/search-events.png)
    Starting with a search on any of your pages, a user might take the following actions:

    1. Select a product from the search results to open the product details page.
    1. Add a product to the shopping cart.
    1. Buy the product.
  </Tab>
  <Tab title="Category page">
    ![Category page](/images/events/browse-events.png)
    Starting with a visit to your home page, a user might take the following actions:

    1. Select a product category to open a category (product listing) page.
    1. Select a product to open a product details page.
    1. Add a product to the shopping cart.
    1. Buy the product.
  </Tab>
  <Tab title="External referrals">
    ![External referrals](/images/events/personalization-events.png)
    Starting with a search on an internet search engine, with a click on a recommendation, or any other external referral, a user might take the following actions:

    1. Click on an (internet) search result, recommendation, or other link to your website.
    1. Depending on where the user lands on your website, they continue the same path as if they started with your homepage or with a category page.
  </Tab>
</Tabs>

import SearchResults from '/snippets/insights/search-results.mdx';

<SearchResults />

#### Product listing and category pages

| User action                        | Method name                       |
| ---------------------------------- | --------------------------------- |
| User clicks product                | `clickedObjectIDsAfterSearch`     |
| User adds product to shopping cart | `addedToCartObjectIDsAfterSearch` |
| User views category page           | `viewedObjectIDs`                 |

#### Product details page

| User action               | Method name                       |
| ------------------------- | --------------------------------- |
| User adds product to cart | `addedToCartObjectIDsAfterSearch` |
| User views product        | `viewedObjectIDs`                 |

#### Checkout page

| User action       | Method name                     |
| ----------------- | ------------------------------- |
| User buys product | `purchasedObjectIDsAfterSearch` |

import TrackQueryid from '/snippets/insights/track-queryid.mdx';

<TrackQueryid />

## Track click events

To send click events with the Insights client, add the following code
whenever a user clicks on a product.

```js JavaScript
aa("clickedObjectIDs", {
  index: "YourIndexName",
  eventName: "Product Clicked",
  objectIDs: ["objectID-1"],
});
```

If you want to track clicks on search results pages, add the following code whenever a user clicks on a product.

```js JavaScript
aa("clickedObjectIDsAfterSearch", {
  index: "YourIndexName",
  queryID: "YourQueryID", // From the search response
  eventName: "Product Clicked",
  objectIDs: ["objectID-1"],
  positions: [1],
});
```

- The `objectID` is included in the search response for each search result as part of the `hits` attribute.
- The `positions` array in `clickedObjectIdsAfterSearch` contains a one-based index of the product hit in the search results.

## Track add-to-cart events

Add the following code to all components and pages where users can add products to their shopping cart.

```js JavaScript
aa("addedToCartObjectIDsAfterSearch", {
  eventName: "Product Added To Cart",
  index: "YourIndexName",
  objectIDs: ["objectID-1"],
  objectData: [
    {
      queryID: "queryID-1",
      price: 19.99,
      discount: 3.99,
      quantity: 3,
    },
  ],
  currency: "USD",
});
```

- The `objectID` is included in the search response for each search result as part of the `hits` attribute.

You should store the query ID with other product details when updating a user's shopping cart.
This makes it easy to record query IDs for each item for any following purchase events.

## Track purchase events

To record when a user completes a purchase,
add the following code:

```js JavaScript
aa("purchasedObjectIDsAfterSearch", {
  eventName: "Products Purchased",
  index: "YourIndexName",
  objectIDs: ["objectID-1", "objectID-2"],
  objectData: [
    {
      queryID: "queryID-1",
      price: 19.99,
      discount: 3.99,
      quantity: 3,
    },
    {
      queryID: "queryID-2",
      price: 59.99,
      quantity: 2,
    },
  ],
  currency: "USD",
});
```

Use `objectData` to record per-object data, such as the price and quantity of the purchased products.

Users often purchase items that were added to the cart in response to different queries.
For example, a user might search for "shoes" and add a pair of shoes to their cart.
Then, they search for "lamp" and add a lamp to their cart. Then, they check out and complete the purchase of both items.
In this case, there would be a single purchase event.
Each item---the shoes and the lamp---will have the query ID of
the search they originated from.

## (Optional) Handle known users for Personalization

For effective personalization, you need to identify users across sessions.
It's best to use an identifier from your authentication,
user profile, or ecommerce service after users signed in.

For more information, see [User token](/guides/send-events/concepts/user-token/).

import PersonalizationUserToken from '/snippets/insights/personalization-user-token.mdx';

<PersonalizationUserToken />

## (Optional) Send view events for Personalization

import ViewEvents from '/snippets/insights/view-events.mdx';

<ViewEvents />

```js JavaScript
window.aa("viewedObjectIDs", {
    index: "YourIndexName",
    eventName: "Product Viewed",
    objectIDs: ["objectID-1"],
});
```